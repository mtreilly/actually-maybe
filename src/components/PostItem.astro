---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';
import { calculateReadingTime, formatReadingTime } from '../utils/readingTime';

interface Props {
	post: CollectionEntry<'blog'>;
	variant?: 'home' | 'blog';
}

const { post, variant = 'home' } = Astro.props;
const readingTime = formatReadingTime(calculateReadingTime(post.data.description));
---

<div class="post-item" data-type={post.data.type}>
	<div class="post-meta">
		<div class="meta-left">
			<time class="post-date" title={post.data.pubDate.toDateString()}>
				<FormattedDate date={post.data.pubDate} />
			</time>
			<span class="post-reading-time">{readingTime}</span>
		</div>
		{variant === 'home' && (
			<a href={`/type/${post.data.type}`} class="post-type-badge" title={`View all ${post.data.type} posts`}>
				<span class="type-label">{post.data.type}</span>
			</a>
		)}
		{variant === 'blog' && (
			<a href={`/type/${post.data.type}`} class="post-type-link">{post.data.type}</a>
		)}
	</div>
	<div class="post-content">
		<a href={`/blog/${post.id}/`} class="post-title">
			{post.data.title}
		</a>
		{post.data.description && (
			<p class="post-description">{post.data.description}</p>
		)}
		{post.data.topics.length > 0 && (
			<div class="post-topics">
				{post.data.topics.map(topic => (
					<a href={`/topics/${topic}`} class="topic-tag">{topic}</a>
				))}
			</div>
		)}
	</div>
</div>

<style>
	.post-item {
		display: flex;
		gap: 1rem;
		padding: 1rem 0;
		align-items: flex-start;
		border-bottom: 1px solid rgba(var(--gray-light), 0.4);
		transition: all 0.2s ease;
		border-left: 2px solid transparent;
		padding-left: 0.75rem;
	}

	.post-item:hover {
		background-color: rgba(37, 99, 235, 0.02);
		border-left-color: var(--accent);
	}

	.post-item:last-child {
		border-bottom: none;
	}

	.post-meta {
		display: flex;
		flex-direction: column;
		align-items: start;
		gap: 0.75rem;
		min-width: fit-content;
		flex-shrink: 0;
		padding-top: 0.125rem;
	}

	.meta-left {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		text-align: left;
		min-width: 6.5rem;
	}

	.post-date,
	.post-reading-time {
		color: rgb(var(--gray));
		font-size: 0.8125rem;
	}

	.post-type-badge {
		display: flex;
		align-items: center;
		gap: 0.375rem;
		padding: 0.375rem 0.625rem;
		border: 1px solid rgba(var(--gray-light), 0.5);
		border-radius: 4px;
		text-decoration: none;
		transition: all 0.2s;
		font-size: 0.75rem;
		white-space: nowrap;
		color: rgb(var(--gray));
	}

	.post-type-badge:hover {
		color: var(--accent);
		border-color: var(--accent);
		background-color: rgba(37, 99, 235, 0.05);
	}

	.post-type-link {
		color: rgb(var(--gray));
		font-size: 0.6875rem;
		text-decoration: none;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-weight: 500;
		transition: color 0.2s;
		display: block;
		margin-top: 0.25rem;
	}

	.post-type-link:hover {
		color: var(--accent);
	}

	.type-label {
		text-transform: uppercase;
		letter-spacing: 0.04em;
		font-weight: 500;
	}

	.post-content {
		flex: 1;
	}

	.post-title {
		color: rgb(var(--black));
		text-decoration: none;
		font-size: 1rem;
		font-weight: 500;
		display: block;
		margin-bottom: 0.25rem;
		transition: color 0.2s;
	}

	.post-title:hover {
		color: var(--accent);
	}

	.post-description {
		color: rgb(var(--gray));
		font-size: 0.875rem;
		line-height: 1.5;
		margin: 0;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.post-topics {
		display: flex;
		gap: 0.5rem;
		margin-top: 0.5rem;
		flex-wrap: wrap;
	}

	.topic-tag {
		font-size: 0.75rem;
		color: rgb(var(--gray));
		text-decoration: none;
		padding: 0.125rem 0.5rem;
		border: 1px solid rgba(var(--gray-light), 1);
		border-radius: 3px;
		transition: all 0.2s;
	}

	.topic-tag:hover {
		color: var(--accent);
		border-color: var(--accent);
		background-color: rgba(37, 99, 235, 0.05);
	}

	/* Enhanced layout for large screens */
	@media (min-width: 1200px) {
		.post-item {
			padding: 1.25rem 0;
			padding-left: 0.75rem;
		}

		.post-title {
			font-size: 1.125rem;
		}

		.post-description {
			font-size: 0.9375rem;
		}
	}

	/* Mobile optimizations */
	@media (max-width: 720px) {
		.post-item {
			flex-direction: column;
			gap: 0.375rem;
			padding: 0.5rem 0;
			padding-left: 0.5rem;
		}

		.post-meta {
			min-width: auto;
			flex-direction: row;
			align-items: center;
			gap: 0.5rem;
			flex-wrap: wrap;
			justify-content: space-between;
			width: 100%;
		}

		.meta-left {
			min-width: auto;
			flex-direction: row;
			gap: 0.5rem;
			text-align: left;
		}

		.post-type-badge {
			margin-left: auto;
		}

		.post-type-link {
			margin-left: auto;
			margin-top: 0;
		}
	}
</style>
