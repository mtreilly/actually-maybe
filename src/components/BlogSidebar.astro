---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import TableOfContents from './TableOfContents.astro';

type Props = {
	relatedPosts?: Array<CollectionEntry<'blog'> & { sharedTopics: number }>;
	headings?: Array<{ depth: number; slug: string; text: string }>;
};

const { relatedPosts = [], headings = [] } = Astro.props;
const topRelatedPosts = relatedPosts.slice(0, 3); // Limit to top 3 related posts
---

<aside class="sidebar">
	<!-- Navigation -->
	<div class="sidebar-section sidebar-nav-section">
		<h3 class="sidebar-title">Navigation</h3>
		<div class="sidebar-nav">
			<a href="/blog/" class="sidebar-nav-link">All Posts</a>
			<a href="/topics" class="sidebar-nav-link">All Topics</a>
		</div>
	</div>

	{/* Table of Contents - prioritized first */}
	{headings && headings.length > 0 && <TableOfContents headings={headings} />}

	{/* Related Posts - show only top 3 */}
	{topRelatedPosts.length > 0 && (
		<div class="sidebar-section">
			<h3 class="sidebar-title">Related Reading</h3>
			<div class="sidebar-list">
				{topRelatedPosts.map((related) => (
					<a href={`/blog/${related.id}/`} class="sidebar-item">
						<span class="sidebar-item-title">{related.data.title}</span>
						<time class="sidebar-item-date">
							<FormattedDate date={related.data.pubDate} />
						</time>
					</a>
				))}
			</div>
		</div>
	)}

</aside>

<style>
	.sidebar {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.sidebar-section {
		border: 1px solid rgba(var(--gray-light), 0.6);
		border-radius: 6px;
		padding: 1rem;
		background: rgba(var(--background), 0.5);
		backdrop-filter: blur(10px);
	}

	.sidebar-nav-section {
		padding: 0.875rem;
	}

	.sidebar-title {
		font-size: 0.8125rem;
		font-weight: 700;
		margin: 0 0 0.875rem 0;
		color: rgb(var(--black));
		text-transform: uppercase;
		letter-spacing: 0.06em;
	}

	.sidebar-list {
		display: flex;
		flex-direction: column;
		gap: 0.625rem;
	}

	.sidebar-item {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		padding: 0.625rem;
		border: 1px solid rgba(var(--gray-light), 0.4);
		border-radius: 4px;
		text-decoration: none;
		transition: all 0.2s;
	}

	.sidebar-item:hover {
		border-color: var(--accent);
		background-color: rgba(37, 99, 235, 0.05);
		transform: translateY(-1px);
	}

	.sidebar-item-title {
		color: rgb(var(--black));
		font-weight: 500;
		font-size: 0.8125rem;
		line-height: 1.3;
	}

	.sidebar-item-date {
		color: rgb(var(--gray));
		font-size: 0.75rem;
	}

	.sidebar-nav {
		display: flex;
		flex-direction: column;
		gap: 0.375rem;
	}

	.sidebar-nav-link {
		color: rgb(var(--gray));
		text-decoration: none;
		font-size: 0.8125rem;
		padding: 0.375rem 0;
		border-bottom: 1px solid rgba(var(--gray-light), 0.3);
		transition: color 0.2s;
	}

	.sidebar-nav-link:hover {
		color: var(--accent);
	}

	.sidebar-nav-link:last-child {
		border-bottom: none;
	}

	/* Dark theme adjustments */
	[data-theme="dark"] .sidebar-section {
		background: rgba(17, 24, 39, 0.6);
		border-color: rgba(75, 85, 99, 0.6);
	}

	[data-theme="dark"] .sidebar-item {
		border-color: rgba(75, 85, 99, 0.4);
	}

	[data-theme="dark"] .sidebar-item:hover {
		background-color: rgba(37, 99, 235, 0.1);
	}

	[data-theme="dark"] .sidebar-nav-link {
		border-color: rgba(75, 85, 99, 0.3);
	}
</style>
